# Models for Identifying Device Activity (Content Analysis)

Content Analysis generates a machine learning model that can predict the device activity given the network traffic of that device.

For step-by-step instructions on getting started, see the [Getting Started](../Getting_Started.md) document.

## Setup

Python 3.6 is required to run this code. Please follow the steps under General Setup in [Getting_Started.md](../Getting_Started.md#general-setup) before continuing.

## Information about the Model

For an explanation about the machine learning models: [model_details.md](model_details.md)

Definition of the device activity: tag name 
[gdoc exp](https://docs.google.com/document/d/1_s6brtocKG0zpdTVNWOxZZdJ1WSkJKKw9gbZh_32WJU/edit)

## Usage

Usage: `python3 main.py (-i TAGGED_DIR [-u UNTAGGED_DIR] | -l IDLE_DIR) [OPTION]...`

Example: `python3 main.py -i traffic/us/ -u sample-untagged/ -dn -o output/ -p 4`

### Input

There are several options which one can choose from.

#### Options

`-i TAGGED_DIR` - The path to the directory containing pcap files with known device activity to generate the machine learning models. See the [traffic/](model_details.md#traffic) section in `model_details.md` for the required structure of this directory. **Either this and/or the `-l` option must be specified.**

`-l IDLE_DIR` - The path to the directory containing idle pcap files to generate the idle activity detection models. **Either this and/or the `-i` option must be specified.**

`-u UNTAGGED_DIR` - The path to the directory containing pcap files with unknown device activity for prediction. See the [traffic/](model_details.md#traffic) section in `model_details.md` for the required structure of this directory. **The `-i` option must be specified to use this option.**

`-d` - Generate a model using the DBSCAN algorithm.

`-k` - Generate a model using the *k*-means algorithm.

`-n` - Generate a model using the *k*-nearest neighbors (KNN) algorithm.

`-r` - Generate a model using the random forest (RF) algorithm.

`-s` - Generate a model using the spectral clustering algorithm.

`-o OUT_DIR` - The path to a directory to place all intermediate and final prediction output. This directory will be generated if it currently does not exist.

`-p NUM_PROC` - The number of processes to use to run parts of this pipeline. Must be a positive integer. Default is `1`.

`-h` - Display the usage statement and exit.

#### Notes

- If no algorithms are specified, the KNN algorithm will be used to generate models.

### Output

This script places all output in `OUT_DIR`. The Tagged Pipeline (`-i` and `-u` options) results are placed in `OUT_DIR/tagged`:

- `s1_train_paths.txt` - The paths to pcap files used to create the machine learning models.
- `s1_test_paths.txt` - The paths to pcap files used to test the trained models.
- `s2.1-train-decoded/` - The directory containing the decoded training pcap files.
- `s2.2-test-decoded/` - The directory containing the decoded testing pcap files.
- `s3.1-train-features/` - The directory containing the statistically-analyzed training files.
- `s3.2-test-features/` - The directory containing the statistically-analyzed testing files.
- `s4-5-models/` - The directory containing the base and anomaly machine learning models.
- `s6_untagged_paths.txt` - The paths to pcap files with unknown device activity.
- `s7-untagged-decoded/` - The directory containing the decoded untagged pcap files.
- `s8-untagged-decoded-split/` - The directory containing the decoded untagged pcap files split into different files by timestamp.
- `s9-untagged-features/` - The directory containing the statistically-analyzed untagged files.
- `s10-results/` - The directory containing the device activity prediction results of the untagged files.

Steps 6-10 are run only if `-u` is specified.

The Idle Pipeline (`-l` option) results are placed in `OUT_DIR/idle`:

- `s1_idle_paths.txt` - The paths to pcap files of the idle data.
- `s2-idle-decoded/` - The directory containing the decoded idle pcap files.
- `s3-idle-features/` - The directory containing the statistically-analyzed idle files.
- `s4i-models/` - The directory containing the model generated by the idle data.

For more information about the files and directories in this section, see [model_details.md](model_details.md#scripts).

